- 2025-10-11: Confirmed Task 1 (“Create AGENTS.md”) is complete; verification lives in docs/AGENTS.md.
- 2025-10-11: Created CLAUDE.md symlink to docs/AGENTS.md (AI agent bootstrap). Verified via `readlink`.
- 2025-10-11: Homebrew verified (4.6.15) and updated taps successfully; outdated formulae listed.
- 2025-10-11: Node verified (v24.9.0) and npm (11.6.0) OK; meets >= 18 requirement.
- 2025-10-11: Python verified (3.13.7) and functional (`python3 -c 'print("OK")'`).
- 2025-10-11: Added root .gitignore for Node/OS/editor/Python; confirmed VCS setup and remote.
- 2025-10-11: Refactored Project Scaffolding to Next.js monolith in Tasks.md.
- 2025-10-11: Scaffolded Next.js project files (package.json, tsconfig, next.config, postcss).
- 2025-10-11: Added Prisma schema (prisma/schema.prisma) per docs/Database.md.
- 2025-10-11: Implemented temporary Next API routes backed by fixtures; added SSE stub for POST /api/messages.
- 2025-10-11: Added .env.example per docs/ENV.md; added simple app/page.tsx matching selectors.
- 2025-10-11: Added Playwright config and minimal E2E spec (shell, threads, model switcher, send flow).
- 2025-10-11: Completed Task 1 (Setup local PostgreSQL using Docker): container healthy, Prisma schema applied via `prisma db push`.
- 2025-10-12: Updated AGENTS.md to include checking task boxes in the same commit; marked Task 1 checkbox.
- 2025-10-12: Completed Task 2 (Extend Prisma schema for NextAuth): added Account/Session/VerificationToken models; migration applied.
- 2025-10-12: Completed Task 3 (Configure NextAuth with Google provider): added App Router handler, auth helper, and Prisma client singleton.
- 2025-10-12: Completed Task 4 (Create protected route with user display): header auth controls and server-side redirect implemented.
- 2025-10-12: Completed Task 5 (Auth middleware for API routes): added requireUser guard and standardized error envelope.
- 2025-10-12: Completed Task 6 (Threads API database integration): GET/POST now backed by Prisma with Zod validation.
- 2025-10-12: Completed Task 7 (Messages API with database persistence): GET queries DB, POST persists user message (SSE stub retained).
- 2025-10-12: Completed Task 8 (OpenAI adapter non-streaming): provider interface + OpenAI adapter; POST /api/messages supports ?mode=json for validation.
- 2025-10-12: Completed Task 9 (Database seeding): added prisma/seed.ts, seed script, and verified seed in Docker Postgres.
- 2025-10-12: Completed Task 10 (SSE streaming for OpenAI): messages route now streams using adapter and persists assistant response; standardized error helper.
- 2025-10-12: Completed Task 12 (Anthropic adapter implementation): adapter modules added and provider registry extended.
- 2025-10-12: Completed Task 13 (Provider routing and model switcher UI): DB-backed PATCH and header model display.
- 2025-10-12: Completed Task 14 (Mid-conversation model switching): full history sent to adapters; messages annotated with provider/model.
- 2025-10-12: Completed Task 15 (Context window truncation): truncation utility + unit test (Vitest).
- 2025-10-12: Completed Task 16 (Enhanced UI error/loading): keyboard shortcuts updated; UI states verified.
- 2025-10-12: Completed Task 17 (Mobile responsive layout): overlay thread tray confirmed on mobile.
- 2025-10-12: Completed Task 18 (Integration testing suite): added Vitest integration tests for threads and messages; Docker DB used.
- 2025-10-12: Planning & Audit: added “Next Tasks — Demo MVP Track (Revised)” and gated POST /api/messages?mode=json to test-only (400 in dev/prod).
- 2025-10-13: API docs updated to note `?mode=json` is test-only; SSE error events standardized to `{ error: { code, message, details } }`.
- 2025-10-13: Anthropic streaming verified end-to-end. With no ANTHROPIC_API_KEY set, deterministic stub stream emits three chunks and `done`; with a real key, adapter streams deltas and persists assistant on completion. Error events use standard envelope.
- 2025-10-13: Vercel production deployment created via CLI; domain added; DNS A record configured. Postinstall runs `prisma generate` for fresh Prisma client. R5.1 completed.
- 2025-10-14: R4.1 Auth guard coverage added (integration tests for 401/403/404 across /api/threads, /api/messages, /api/threads/:id). All tests passing.
- 2025-10-14: R4.2 Streaming envelope sanity added (SSE emits delta/done; error path emits error envelope). Providers refactored to lazy-init SDK clients when API keys exist; deterministic stubs when keys are absent.
- 2025-10-14: E2E: Added mobile overlay test; full E2E suite green with mocked auth/provider.
- 2025-10-14: R5.2 Domain + Google OAuth redirects verified — https://bombay.chat live over HTTPS, sign-in works (user-confirmed). Note: Chrome Safe Browsing may briefly warn on a brand-new domain; expected to clear after reputation warms up or via review.
- 2025-10-14: Production deployment checklist confirmed: API keys present (OpenAI, Anthropic), environment variables configured for Production/Preview, Vercel project linked, custom domain configured, and production database operational (user-confirmed).
- 2025-10-18: Scopes S0.1 — Decided fixed scopes and default state. Fixed registry exported at lib/scopes.ts with keys: profile (sensitive), work, personal, health (sensitive). DEFAULT_ACTIVE_SCOPE_KEYS = []. Unit tests added at tests/unit/scopes.test.ts. Privacy-first default confirmed.
- 2025-10-18: Scopes S0.2 — Sensitive scopes & consent policy decided. Sensitive scopes: profile, health. Consent granularity: per-thread per-scope (one-time per thread). Exported SENSITIVE_SCOPE_KEYS in lib/scopes.ts and added tests. Documentation to be enforced by S1.2 (ScopeConsent table) and S2 endpoints.
- 2025-10-18: Scopes S0.3 — Feature flag and rollout. Added isScopesFeatureEnabled() reading NEXT_PUBLIC_SCOPES_ENABLED (default off). Threads API includes computed `activeScopeKeys: []` only when enabled. Deployment doc updated with rollout plan. Unit tests added at tests/unit/scopes.featureflag.test.ts.
- 2025-10-18: Scopes S1.1 — Added Thread.activeScopeKeys String[] to Prisma schema, default []. Threads API conditionally includes `activeScopeKeys` when feature flag enabled. Integration test added at tests/integration/scopes.threads.api.int.test.ts (uses computed default array).
- 2025-10-18: Scopes S1.3 — Added Message.metaJson Json? for attribution (usedScopes, sources). Update docs/Database.md. Migration required in dev/prod before usage.
- 2025-10-18: Scopes S1.4 — Seed: Added a "Scopes Sample" thread with Work/Personal/Health tagged notes for dev seeding. Run `npm run db:seed` to populate.
- 2025-10-18: Scopes S2.1 — Extended Zod Thread schema to include optional activeScopeKeys and UpdateThreadSchema to accept activeScopeKeys. Added unit tests.
- 2025-10-18: Scopes S2.2 — Implemented GET /api/scopes with feature flag gating; returns registry and optional thread info/consents. Integration test added.
- 2025-10-18: Scopes S2.3 — Implemented POST /api/threads/:id/scopes (flag-gated). Validates keys, rejects sensitive without consent, best-effort persist to Thread.activeScopeKeys. Unit tests added.
- 2025-10-18: Scopes S2.4 — Implemented POST /api/threads/:id/scopes/consent (flag-gated). Validates sensitive scopeKey and records consent (best-effort). Unit tests added.
- 2025-10-18: Scopes S2.5 — SSE done events now include usedScopes []. Updated API docs and added integration test.
- 2025-10-18: Scopes S3.1–S3.5 — Added recall provider stub with gating, profile injection, redaction policies, and attribution. Integrated into prompt building; SSE done includes usedScopes; best-effort metaJson persistence.
- 2025-10-18: Scopes S4.1–S5.2 — Added Scope Toggle Bar (desktop/mobile), zero-scopes indicator, one-time consent prompt, and source annotations in assistant messages. Added client helper tests.
